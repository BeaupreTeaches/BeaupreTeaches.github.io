<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Zoomable Julia Set</title>
  <style>
    body {
      margin: 0;
      background: black;
      color: white;
      font-family: Arial;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    canvas {
      border: 1px solid #444;
      margin-top: 1rem;
      cursor: zoom-in;
    }
  </style>
</head>
<body>
  <h2>Zoomable Julia Set</h2>
  <canvas id="juliaCanvas" width="600" height="600"></canvas>

  <script>
    const canvas = document.getElementById('juliaCanvas');
    const ctx = canvas.getContext('2d');
    const width = canvas.width;
    const height = canvas.height;

    // Complex viewport boundaries
    let minRe = -1.5, maxRe = 1.5;
    let minIm = -1.5, maxIm = 1.5;

    const maxIter = 300;
    const cRe = -0.7;
    const cIm = 0.27015;

    function julia(x, y) {
      let zx = x;
      let zy = y;
      let i = maxIter;
      while (zx*zx + zy*zy < 4 && i > 0) {
        let tmp = zx*zx - zy*zy + cRe;
        zy = 2.0 * zx * zy + cIm;
        zx = tmp;
        i--;
      }
      return i;
    }

    function drawJulia() {
      const imgData = ctx.createImageData(width, height);
      for (let x = 0; x < width; x++) {
        for (let y = 0; y < height; y++) {
          // Map screen to complex plane
          let zx = minRe + (x / width) * (maxRe - minRe);
          let zy = minIm + (y / height) * (maxIm - minIm);

          let i = julia(zx, zy);
          let p = (y * width + x) * 4;
          let color = i === 0 ? 0 : 255 - Math.floor(i * 255 / maxIter);
          imgData.data[p] = color;
          imgData.data[p + 1] = color;
          imgData.data[p + 2] = color;
          imgData.data[p + 3] = 255;
        }
      }
      ctx.putImageData(imgData, 0, 0);
    }

    function zoomAt(x, y, scale) {
      // Convert screen coords to complex
      const re = minRe + (x / width) * (maxRe - minRe);
      const im = minIm + (y / height) * (maxIm - minIm);

      const reWidth = maxRe - minRe;
      const imHeight = maxIm - minIm;

      const newReWidth = reWidth * scale;
      const newImHeight = imHeight * scale;

      minRe = re - (re - minRe) * scale;
      maxRe = minRe + newReWidth;

      minIm = im - (im - minIm) * scale;
      maxIm = minIm + newImHeight;
    }

    canvas.addEventListener('wheel', (e) => {
      e.preventDefault();
      const zoomIn = e.deltaY < 0;
      const zoomFactor = zoomIn ? 0.8 : 1.25;
      zoomAt(e.offsetX, e.offsetY, zoomFactor);
      drawJulia();
    });

    drawJulia();
  </script>
</body>
</html>
